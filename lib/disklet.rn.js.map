{"version":3,"file":"disklet.rn.js","sources":["../src/backends/dummy.ts","../src/helpers/paths.ts","../src/backends/local-storage.ts","../src/backends/memory.ts","../src/backends/react-native.ts","../src/legacy/downgrade.ts","../src/legacy/helpers.ts","../src/legacy/loggedFolder.ts","../src/legacy/unionFolder.ts","../src/helpers/deep-list.ts","../src/helpers/log.ts","../src/helpers/merge.ts","../src/helpers/navigate.ts","../src/react-native.ts"],"sourcesContent":["import { Disklet } from '../index'\n\nexport function makeNodeDisklet(path: string): Disklet {\n  throw new Error('makeNodeDisklet is not available on this platform')\n}\n\nexport function makeReactNativeDisklet(): Disklet {\n  throw new Error('makeReactNativeDisklet is not available on this platform')\n}\n","/**\n * Interprets a path as a series of folder lookups,\n * handling special components like `.` and `..`.\n */\nexport function normalizePath(path: string): string {\n  if (/^\\//.test(path)) throw new Error('Absolute paths are not supported')\n  const parts = path.split('/')\n\n  // Shift down good elements, dropping bad ones:\n  let i = 0 // Read index\n  let j = 0 // Write index\n  while (i < parts.length) {\n    const part = parts[i++]\n    if (part === '..') j--\n    else if (part !== '.' && part !== '') parts[j++] = part\n\n    if (j < 0) throw new Error('Path would escape folder')\n  }\n\n  // Array items from 0 to j are the path:\n  return parts.slice(0, j).join('/')\n}\n\n/**\n * Appends a slash if the path isn't blank.\n */\nexport function folderizePath(path: string): string {\n  return path === '' ? path : path + '/'\n}\n","import { base64 } from 'rfc4648'\n\nimport { folderizePath, normalizePath } from '../helpers/paths'\nimport { Disklet, DiskletListing } from '../index'\n\n// The Typescript DOM library isn't available on React Native,\n// so work around that:\nexport interface WebStorage {\n  readonly length: number\n  getItem(key: string): string | null\n  key(index: number): string | null\n  removeItem(key: string): void\n  setItem(key: string, value: string): void\n}\ndeclare const window: { localStorage: WebStorage }\n\n/**\n * Lists the keys in a localStorage object.\n */\nfunction storageKeys(storage: WebStorage): string[] {\n  const out = []\n  for (let i = 0; i < storage.length; ++i) {\n    const key = storage.key(i)\n    if (key != null) out.push(key)\n  }\n  return out\n}\n\n/**\n * Emulates a filesystem in memory.\n */\nexport function makeLocalStorageDisklet(\n  storage: WebStorage = window.localStorage,\n  opts: { prefix?: string } = {}\n): Disklet {\n  const prefix = opts.prefix != null ? folderizePath(opts.prefix) : '/'\n\n  return {\n    delete(path: string): Promise<unknown> {\n      const file = normalizePath(path)\n\n      // Try deleteing as a file:\n      if (storage.getItem(prefix + file) != null) {\n        storage.removeItem(prefix + file)\n      }\n\n      // Try deleting as a folder:\n      const folder = folderizePath(file)\n      for (const key of storageKeys(storage)) {\n        if (key.indexOf(prefix + folder) === 0) storage.removeItem(key)\n      }\n      return Promise.resolve()\n    },\n\n    getData(path: string): Promise<Uint8Array> {\n      return this.getText(path).then(text => base64.parse(text))\n    },\n\n    getText(path: string): Promise<string> {\n      const file = normalizePath(path)\n      const item = storage.getItem(prefix + file)\n      if (item == null) {\n        return Promise.reject(new Error(`Cannot load \"${file}\"`))\n      }\n      return Promise.resolve(item)\n    },\n\n    async list(path: string = ''): Promise<DiskletListing> {\n      const file = normalizePath(path)\n      const out: DiskletListing = {}\n\n      // Try the path as a file:\n      if (storage.getItem(prefix + file) != null) out[file] = 'file'\n\n      // Try the path as a folder:\n      const folder = folderizePath(file)\n      for (const key of storageKeys(storage)) {\n        if (key.indexOf(prefix + folder) !== 0) continue\n\n        const slash = key.indexOf('/', prefix.length + folder.length)\n        if (slash < 0) out[key.slice(prefix.length)] = 'file'\n        else out[key.slice(prefix.length, slash)] = 'folder'\n      }\n\n      return Promise.resolve(out)\n    },\n\n    setData(path: string, data: ArrayLike<number>) {\n      return this.setText(path, base64.stringify(data))\n    },\n\n    setText(path: string, text: string): Promise<unknown> {\n      if (typeof text !== 'string') {\n        return Promise.reject(new TypeError('setText expects a string'))\n      }\n\n      storage.setItem(prefix + normalizePath(path), text)\n      return Promise.resolve()\n    }\n  }\n}\n","import { folderizePath, normalizePath } from '../helpers/paths'\nimport { Disklet, DiskletListing } from '../index'\n\nexport interface MemoryStorage {\n  [key: string]: string | Uint8Array\n}\n\n/**\n * Emulates a filesystem in memory.\n */\nexport function makeMemoryDisklet(storage: MemoryStorage = {}): Disklet {\n  return {\n    delete(path: string): Promise<unknown> {\n      const file = normalizePath(path)\n\n      // Try deleteing as a file:\n      if (storage['/' + file] != null) delete storage['/' + file]\n\n      // Try deleting as a folder:\n      const folder = folderizePath(file)\n      for (const key of Object.keys(storage)) {\n        if (key.indexOf('/' + folder) === 0) delete storage[key]\n      }\n      return Promise.resolve()\n    },\n\n    getData(path: string): Promise<Uint8Array> {\n      const file = normalizePath(path)\n      const item = storage['/' + file]\n      if (item == null) {\n        return Promise.reject(new Error(`Cannot load \"${file}\"`))\n      }\n      if (typeof item === 'string') {\n        return Promise.reject(new Error(`\"${file}\" is a text file.`))\n      }\n      return Promise.resolve(item)\n    },\n\n    getText(path: string): Promise<string> {\n      const file = normalizePath(path)\n      const item = storage['/' + file]\n      if (item == null) {\n        return Promise.reject(new Error(`Cannot load \"${file}\"`))\n      }\n      if (typeof item !== 'string') {\n        return Promise.reject(new Error(`\"${file}\" is a binary file.`))\n      }\n      return Promise.resolve(item)\n    },\n\n    async list(path: string = ''): Promise<DiskletListing> {\n      const file = normalizePath(path)\n      const out: DiskletListing = {}\n\n      // Try the path as a file:\n      if (storage['/' + file] != null) out[file] = 'file'\n\n      // Try the path as a folder:\n      const folder = folderizePath(file)\n      for (const key of Object.keys(storage)) {\n        if (key.indexOf('/' + folder) !== 0) continue\n\n        const slash = key.indexOf('/', 1 + folder.length)\n        if (slash < 0) out[key.slice(1)] = 'file'\n        else out[key.slice(1, slash)] = 'folder'\n      }\n\n      return Promise.resolve(out)\n    },\n\n    setData(path: string, data: ArrayLike<number>) {\n      // We use `any` here becase Flow is too dumb to know that `ArrayLike`\n      // is a perfectly acceptable argument to `Uint8Array.from`:\n      const flowHack: any = data\n      const array = Uint8Array.from(flowHack)\n\n      storage['/' + normalizePath(path)] = array\n      return Promise.resolve()\n    },\n\n    setText(path: string, text: string): Promise<unknown> {\n      if (typeof text !== 'string') {\n        return Promise.reject(new TypeError('setText expects a string'))\n      }\n\n      storage['/' + normalizePath(path)] = text\n      return Promise.resolve()\n    }\n  }\n}\n","import { NativeModules } from 'react-native'\nimport { base64 } from 'rfc4648'\n\nimport { normalizePath } from '../helpers/paths'\nimport { Disklet, DiskletListing } from '../index'\n\nconst native = NativeModules.Disklet\n\n/**\n * Returns a Disklet interface located in the application's data directory.\n */\nexport function makeReactNativeDisklet(): Disklet {\n  return {\n    delete(path: string): Promise<unknown> {\n      return native.delete(normalizePath(path))\n    },\n\n    getData(path: string): Promise<Uint8Array> {\n      return native\n        .getData(normalizePath(path))\n        .then((data: string) => base64.parse(data))\n    },\n\n    getText(path: string): Promise<string> {\n      return native.getText(normalizePath(path))\n    },\n\n    list(path: string = ''): Promise<DiskletListing> {\n      return native.list(normalizePath(path))\n    },\n\n    setData(path: string, data: ArrayLike<number>): Promise<unknown> {\n      return native.setData(normalizePath(path), base64.stringify(data))\n    },\n\n    setText(path: string, text: string): Promise<unknown> {\n      return native.setText(normalizePath(path), text)\n    }\n  }\n}\n","import { Disklet } from '../index'\nimport { DiskletFile, DiskletFolder } from './legacy'\n\nclass File {\n  _disklet: Disklet\n  _path: string\n\n  constructor(disklet: Disklet, path: string) {\n    this._disklet = disklet\n    this._path = path\n  }\n\n  delete(): Promise<unknown> {\n    return this._disklet.delete(this._path)\n  }\n\n  getData(): Promise<Uint8Array> {\n    return this._disklet.getData(this._path)\n  }\n\n  getText(): Promise<string> {\n    return this._disklet.getText(this._path)\n  }\n\n  setData(data: ArrayLike<number>): Promise<unknown> {\n    return this._disklet.setData(this._path, data)\n  }\n\n  setText(text: string): Promise<unknown> {\n    return this._disklet.setText(this._path, text)\n  }\n}\n\nclass Folder {\n  _disklet: Disklet\n  _path: string\n\n  constructor(disklet: Disklet, path: string) {\n    this._disklet = disklet\n    this._path = path\n  }\n\n  delete(): Promise<unknown> {\n    return this._disklet.delete(this._path)\n  }\n\n  file(path: string): DiskletFile {\n    return new File(this._disklet, this._path + '/' + path)\n  }\n\n  folder(path: string): DiskletFolder {\n    return new Folder(this._disklet, this._path + '/' + path)\n  }\n\n  listFiles(): Promise<string[]> {\n    return this._disklet.list(this._path).then(list =>\n      Object.keys(list)\n        .filter(path => list[path] === 'file')\n        .map(path => path.replace(/^.*\\//, ''))\n    )\n  }\n\n  listFolders(): Promise<string[]> {\n    return this._disklet.list(this._path).then(list =>\n      Object.keys(list)\n        .filter(path => list[path] === 'folder')\n        .map(path => path.replace(/^.*\\//, ''))\n    )\n  }\n}\n\nexport function downgradeDisklet(disklet: Disklet): DiskletFolder {\n  return new Folder(disklet, '.')\n}\n","import { DiskletFile, DiskletFolder } from './legacy'\n\n/**\n * Interprets a path as a series of folder lookups,\n * handling special components like `.` and `..`.\n */\nfunction followPath(folder: DiskletFolder, parts: string[]): DiskletFolder {\n  let i = 0 // Read index\n  let j = 0 // Write index\n\n  // Shift down good elements, dropping bad ones:\n  while (i < parts.length) {\n    const part = parts[i++]\n    if (part === '..') j--\n    else if (part !== '.' && part !== '') parts[j++] = part\n\n    if (j < 0) throw new Error('Path would escape folder')\n  }\n\n  // Navigate the folder:\n  for (i = 0; i < j; ++i) {\n    folder = folder.folder(parts[i])\n  }\n  return folder\n}\n\n/**\n * Navigates down to the file indicated by the path.\n */\nexport function locateFile(folder: DiskletFolder, path: string): DiskletFile {\n  const parts = path.split('/')\n  const filename = parts.pop()\n  if (filename == null) throw new Error('Empty path')\n  return followPath(folder, parts).file(filename)\n}\n\n/**\n * Navigates down to the sub-folder indicated by the path.\n */\nexport function locateFolder(\n  folder: DiskletFolder,\n  path: string\n): DiskletFolder {\n  const parts = path.split('/')\n  return followPath(folder, parts)\n}\n\ntype FileIterator<T> = (\n  file: DiskletFile,\n  name: string,\n  parentFolder: DiskletFolder\n) => T | Promise<T>\n\ntype FolderIterator<T> = (\n  folder: DiskletFolder,\n  name: string,\n  parentFolder: DiskletFolder\n) => T | Promise<T>\n\n/**\n * Applies an async function to all the files in a folder.\n */\nexport function mapFiles<T>(\n  folder: DiskletFolder,\n  f: FileIterator<T>\n): Promise<T[]> {\n  return folder\n    .listFiles()\n    .then(names =>\n      Promise.all(names.map(name => f(folder.file(name), name, folder)))\n    )\n}\n\n/**\n * Applies an async function to all the sub-folders in a folder.\n */\nexport function mapFolders<T>(\n  folder: DiskletFolder,\n  f: FolderIterator<T>\n): Promise<T[]> {\n  return folder\n    .listFolders()\n    .then(names =>\n      Promise.all(names.map(name => f(folder.folder(name), name, folder)))\n    )\n}\n\n/**\n * Recursively applies an async function to all the files in a folder tree.\n * The file names are expanded into paths, and the result is a flat array.\n */\nexport function mapAllFiles<T>(\n  folder: DiskletFolder,\n  f: FileIterator<T>\n): Promise<T[]> {\n  function recurse(\n    folder: DiskletFolder,\n    f: FileIterator<T>,\n    prefix: string\n  ): Promise<T[]> {\n    return Promise.all([\n      mapFiles(folder, (file, name) => f(file, prefix + name, folder)),\n      mapFolders(folder, (folder, name) =>\n        recurse(folder, f, prefix + name + '/')\n      )\n    ]).then(([files, folders]) => files.concat(...folders))\n  }\n\n  return recurse(folder, f, '')\n}\n","import { DiskletFile, DiskletFolder } from './legacy'\n\ntype LogOperation =\n  | 'delete file'\n  | 'delete folder'\n  | 'get data'\n  | 'get text'\n  | 'list files'\n  | 'list folders'\n  | 'set data'\n  | 'set text'\n\ninterface LogOptions {\n  callback?: (path: string, operation: LogOperation) => unknown\n  verbose?: boolean\n}\n\nfunction logConsole(path: string, operation: string): void {\n  console.log(`${operation} \"${path}\"`)\n}\n\nfunction log(path: string, operation: LogOperation, opts: LogOptions): void {\n  const { callback = logConsole, verbose = false } = opts\n  if (verbose || /set|delete/.test(operation)) {\n    callback(path, operation)\n  }\n}\n\nclass LoggedFile {\n  _file: DiskletFile\n  _opts: LogOptions\n  _path: string\n\n  constructor(file: DiskletFile, path: string, opts: LogOptions) {\n    this._file = file\n    this._path = path\n    this._opts = opts\n  }\n\n  delete(): Promise<unknown> {\n    log(this._path, 'delete file', this._opts)\n    return this._file.delete()\n  }\n\n  getData(): Promise<Uint8Array> {\n    log(this._path, 'get data', this._opts)\n    return this._file.getData()\n  }\n\n  getText(): Promise<string> {\n    log(this._path, 'get text', this._opts)\n    return this._file.getText()\n  }\n\n  setData(data: ArrayLike<number>): Promise<unknown> {\n    log(this._path, 'set data', this._opts)\n    return this._file.setData(data)\n  }\n\n  setText(text: string): Promise<unknown> {\n    log(this._path, 'set text', this._opts)\n    return this._file.setText(text)\n  }\n\n  getPath(): string {\n    return this._path\n  }\n}\n\nclass LoggedFolder {\n  _folder: DiskletFolder\n  _opts: LogOptions\n  _path: string\n\n  constructor(folder: DiskletFolder, path: string, opts: LogOptions) {\n    this._folder = folder\n    this._path = path\n    this._opts = opts\n  }\n\n  delete(): Promise<unknown> {\n    log(this._path, 'delete folder', this._opts)\n    return this._folder.delete()\n  }\n\n  file(name: string): DiskletFile {\n    return new LoggedFile(\n      this._folder.file(name),\n      this._path + name,\n      this._opts\n    )\n  }\n\n  folder(name: string): DiskletFolder {\n    return new LoggedFolder(\n      this._folder.folder(name),\n      this._path + name + '/',\n      this._opts\n    )\n  }\n\n  listFiles(): Promise<string[]> {\n    log(this._path, 'list files', this._opts)\n    return this._folder.listFiles()\n  }\n\n  listFolders(): Promise<string[]> {\n    log(this._path, 'list folders', this._opts)\n    return this._folder.listFolders()\n  }\n}\n\nexport function makeLoggedFolder(\n  folder: DiskletFolder,\n  opts: LogOptions = {}\n): DiskletFolder {\n  return new LoggedFolder(folder, '', opts)\n}\n","import { mapFiles, mapFolders } from './helpers'\nimport { DiskletFile, DiskletFolder } from './legacy'\n\nfunction removeDuplicates(master: string[], fallback: string[]): string[] {\n  const blacklist: { [name: string]: true } = {}\n  const out: string[] = []\n  master.forEach(item => {\n    if (/\\._x_$/.test(item)) {\n      blacklist[item] = true\n    } else {\n      blacklist[item + '._x_'] = true\n      out.push(item)\n    }\n  })\n\n  fallback.forEach(item => {\n    if (!blacklist[item + '._x_']) out.push(item)\n  })\n\n  return out\n}\n\n/**\n * A file within a unionFolder.\n */\nclass UnionFile {\n  _master: DiskletFile\n  _fallback: DiskletFile\n  _whiteout: DiskletFile\n\n  constructor(\n    master: DiskletFile,\n    fallback: DiskletFile,\n    whiteout: DiskletFile\n  ) {\n    this._master = master\n    this._fallback = fallback\n    this._whiteout = whiteout\n  }\n\n  delete(): Promise<unknown> {\n    return Promise.all([\n      this._whiteout.setData([]),\n      this._master.delete().catch(e => null)\n    ])\n  }\n\n  getData(): Promise<Uint8Array> {\n    return this._master.getData().catch(e =>\n      this._whiteout.getData().then(\n        data => {\n          throw new Error('File has been deleted')\n        },\n        e => this._fallback.getData()\n      )\n    )\n  }\n\n  getText(): Promise<string> {\n    return this._master.getText().catch(e =>\n      this._whiteout.getData().then(\n        data => {\n          throw new Error('File has been deleted')\n        },\n        e => this._fallback.getText()\n      )\n    )\n  }\n\n  setData(data: ArrayLike<number>): Promise<unknown> {\n    return this._master.setData(data)\n  }\n\n  setText(text: string): Promise<unknown> {\n    return this._master.setText(text)\n  }\n\n  getPath(): string {\n    throw new Error('Cannot call getPath on a Union Folder')\n  }\n}\n\n/**\n * Reads and writes go to a master folder, but if a read fails,\n * we will also try the fallback folder.\n */\nexport class UnionFolder {\n  _master: DiskletFolder\n  _fallback: DiskletFolder\n\n  constructor(master: DiskletFolder, fallback: DiskletFolder) {\n    this._master = master\n    this._fallback = fallback\n  }\n\n  delete(): Promise<unknown> {\n    return Promise.all([\n      mapFiles(this, file => file.delete()),\n      mapFolders(this, folder => folder.delete())\n    ]).then(() => {})\n  }\n\n  file(name: string): DiskletFile {\n    return new UnionFile(\n      this._master.file(name),\n      this._fallback.file(name),\n      this._master.file(name + '._x_')\n    )\n  }\n\n  folder(name: string): DiskletFolder {\n    return new UnionFolder(\n      this._master.folder(name),\n      this._fallback.folder(name)\n    )\n  }\n\n  listFiles(): Promise<string[]> {\n    return Promise.all([\n      this._master.listFiles(),\n      this._fallback.listFiles()\n    ]).then(values => removeDuplicates(values[0], values[1]))\n  }\n\n  listFolders(): Promise<string[]> {\n    return Promise.all([\n      this._master.listFolders(),\n      this._fallback.listFolders()\n    ]).then(values => removeDuplicates(values[0], values[1]))\n  }\n}\n\nexport function makeUnionFolder(\n  master: DiskletFolder,\n  fallback: DiskletFolder\n): DiskletFolder {\n  return new UnionFolder(master, fallback)\n}\n","import { Disklet, DiskletListing } from '../index'\n\n/**\n * Recursively lists a folder.\n */\nexport function deepList(\n  disklet: Disklet,\n  path?: string\n): Promise<DiskletListing> {\n  return disklet.list(path).then(list =>\n    // Recurse into subfolders:\n    Promise.all(\n      Object.keys(list)\n        .filter(path => list[path] === 'folder')\n        .map(path => deepList(disklet, path))\n    ).then(children => Object.assign(list, ...children))\n  )\n}\n","import { Disklet, DiskletListing } from '../index'\nimport { normalizePath } from './paths'\n\ntype LogOperation =\n  | 'delete'\n  | 'get data'\n  | 'get text'\n  | 'list'\n  | 'set data'\n  | 'set text'\n\ninterface LogOptions {\n  callback?: (path: string, operation: LogOperation) => unknown\n  verbose?: boolean\n}\n\nexport function logDisklet(disklet: Disklet, opts: LogOptions = {}): Disklet {\n  const {\n    callback = (path: string, operation: string) => {\n      console.log(`${operation} \"${path}\"`)\n    },\n    verbose = false\n  } = opts\n\n  const log = (operation: LogOperation, path: string): void => {\n    if (verbose || /set|delete/.test(operation)) {\n      callback(path, operation)\n    }\n  }\n\n  return {\n    delete(path: string): Promise<unknown> {\n      log('delete', normalizePath(path))\n      return disklet.delete(path)\n    },\n\n    getData(path: string): Promise<Uint8Array> {\n      log('get data', normalizePath(path))\n      return disklet.getData(path)\n    },\n\n    getText(path: string): Promise<string> {\n      log('get text', normalizePath(path))\n      return disklet.getText(path)\n    },\n\n    list(path?: string): Promise<DiskletListing> {\n      log('list', path != null ? normalizePath(path) : '')\n      return disklet.list(path)\n    },\n\n    setData(path: string, data: ArrayLike<number>): Promise<unknown> {\n      log('set data', normalizePath(path))\n      return disklet.setData(path, data)\n    },\n\n    setText(path: string, text: string): Promise<unknown> {\n      log('set text', normalizePath(path))\n      return disklet.setText(path, text)\n    }\n  }\n}\n","import { Disklet, DiskletListing } from '../index'\n\nexport function mergeDisklets(master: Disklet, fallback: Disklet): Disklet {\n  return {\n    delete(path: string): Promise<unknown> {\n      return Promise.all([master.delete(path), fallback.delete(path)])\n    },\n\n    getData(path: string): Promise<Uint8Array> {\n      return master.getData(path).catch(e => fallback.getData(path))\n    },\n\n    getText(path: string): Promise<string> {\n      return master.getText(path).catch(e => fallback.getText(path))\n    },\n\n    list(path?: string): Promise<DiskletListing> {\n      return Promise.all([master.list(path), fallback.list(path)]).then(\n        ([masterList, fallbackList]) => Object.assign(fallbackList, masterList)\n      )\n    },\n\n    setData(path: string, data: ArrayLike<number>): Promise<unknown> {\n      return master.setData(path, data)\n    },\n\n    setText(path: string, text: string): Promise<unknown> {\n      return master.setText(path, text)\n    }\n  }\n}\n","import { Disklet, DiskletListing } from '../index'\nimport { folderizePath, normalizePath } from './paths'\n\nexport function navigateDisklet(disklet: Disklet, path: string): Disklet {\n  const prefix = folderizePath(normalizePath(path))\n\n  return {\n    delete(path: string): Promise<unknown> {\n      return disklet.delete(prefix + path)\n    },\n\n    getData(path: string): Promise<Uint8Array> {\n      return disklet.getData(prefix + path)\n    },\n\n    getText(path: string): Promise<string> {\n      return disklet.getText(prefix + path)\n    },\n\n    list(path: string = '.'): Promise<DiskletListing> {\n      return disklet.list(prefix + path).then(listing => {\n        const out: DiskletListing = {}\n        for (const path in listing) {\n          out[path.replace(prefix, '')] = listing[path]\n        }\n        return out\n      })\n    },\n\n    setData(path: string, data: ArrayLike<number>): Promise<unknown> {\n      return disklet.setData(prefix + path, data)\n    },\n\n    setText(path: string, text: string): Promise<unknown> {\n      return disklet.setText(prefix + path, text)\n    }\n  }\n}\n","import { makeNodeDisklet } from './backends/dummy'\nimport { makeLocalStorageDisklet, WebStorage } from './backends/local-storage'\nimport { makeMemoryDisklet, MemoryStorage } from './backends/memory'\nimport { makeReactNativeDisklet } from './backends/react-native'\nimport { DiskletFolder, downgradeDisklet } from './legacy/legacy'\n\nexport * from './helpers/helpers'\nexport * from './legacy/legacy'\nexport * from './types'\nexport {\n  makeLocalStorageDisklet,\n  makeMemoryDisklet,\n  makeNodeDisklet,\n  makeReactNativeDisklet\n}\n\n// legacy API ----------------------------------------------------------------\n\nexport function makeLocalStorageFolder(\n  storage: WebStorage,\n  opts?: { prefix?: string }\n): DiskletFolder {\n  return downgradeDisklet(makeLocalStorageDisklet(storage, opts))\n}\n\nexport function makeMemoryFolder(storage?: MemoryStorage): DiskletFolder {\n  return downgradeDisklet(makeMemoryDisklet(storage))\n}\n\nexport function makeNodeFolder(path: string): DiskletFolder {\n  return downgradeDisklet(makeNodeDisklet(path))\n}\n\nexport function makeReactNativeFolder(): DiskletFolder {\n  return downgradeDisklet(makeReactNativeDisklet())\n}\n"],"names":["makeNodeDisklet","path","Error","normalizePath","test","parts","split","i","j","length","part","slice","join","folderizePath","storageKeys","storage","out","key","push","makeLocalStorageDisklet","opts","window","localStorage","prefix","file","getItem","removeItem","folder","indexOf","Promise","resolve","getData","getText","then","text","base64","parse","item","reject","list","slash","setData","data","setText","stringify","TypeError","setItem","makeMemoryDisklet","Object","keys","flowHack","array","Uint8Array","from","native","NativeModules","Disklet","makeReactNativeDisklet","File","disklet","_disklet","_path","Folder","listFiles","filter","map","replace","listFolders","downgradeDisklet","followPath","locateFile","filename","pop","locateFolder","mapFiles","f","names","all","name","mapFolders","mapAllFiles","recurse","files","folders","concat","logConsole","operation","console","log","callback","verbose","LoggedFile","_file","_opts","getPath","LoggedFolder","_folder","makeLoggedFolder","removeDuplicates","master","fallback","blacklist","forEach","UnionFile","whiteout","_master","_fallback","_whiteout","e","UnionFolder","values","makeUnionFolder","deepList","children","logDisklet","mergeDisklets","masterList","fallbackList","navigateDisklet","listing","makeLocalStorageFolder","makeMemoryFolder","makeNodeFolder","makeReactNativeFolder"],"mappings":"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"}